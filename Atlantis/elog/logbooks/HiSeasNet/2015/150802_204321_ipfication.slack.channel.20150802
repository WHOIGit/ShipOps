stevefoley [5:04 PM] 
running a few mins late. How gors things on your end?

lstolp [5:05 PM] 
we are here.. we have not changed the ip numbers on the modem, did not get the new document, but maybe that part had not changed ?

stevefoley [5:05 PM] 
sorry…
stevefoley 
[5:05 PM] 
hsnadmin-29949991-280715-0005-15.pdf  
19KB PDF shared with you • Add comment 

lstolp [5:07 PM] 
thanks.. the HSN is up and working over the serial link, so I will go ahead and make the changes and plug in  an ethernet cable?

stevefoley [5:09 PM] 
ok. Its gonna take me a little bit to straighten out some things here.

lstolp [5:11 PM] 
ok.. take your time… catie updated the firmware to latest one you sent around

stevefoley [5:11 PM] 
the 6May one or the 24Jun one?

stevefoley [5:12 PM]
the 24Jun has a bug that makes it not work for us in this instance. 6 May is the right one

lstolp [5:16 PM] 
she used the 6May

lstolp [5:20 PM]
maybe we are on the wrong one.. on web interface Edit->Tx->Service->Closed  does not exist

stevefoley [5:21 PM] 
lemme look

stevefoley [5:22 PM]
Are you using the web interface or the front panel?

lstolp [5:25 PM] 
web interface

stevefoley [5:25 PM] 
Should be in the edit menu, Tx/Rx tab, Service, then one of the top entries (“Tx Service”)

lstolp [5:26 PM] 
ok.. can we invite people or make a group so allison can join?

stevefoley [5:26 PM] 
sure thing

stevefoley [5:26 PM]
standby

stevefoley [11:52 PM] 
Stilll scratching my head about stuff.

stevefoley [11:52 PM]
If you have access to that shipboard router remotely, I might ask for a tweak or a confirmation, but I might not get this going for a little while.

stevefoley [11:52 PM]
Our testbed was perfect, but no good plan survives contact with the enemy, right?

lstolp [11:53 PM] 
I am scratched out.. started at 0400..

lstolp [11:53 PM]
I can access the router from away, and the ship is happily on the landline

stevefoley [11:53 PM] 
I hear you. Got an early morning myself tomorrow

stevefoley [11:53 PM]
ok. Ill need some time to hash this out.

stevefoley [11:54 PM]
Sorry to keep you late. Was hoping our Oceanus transition on Sunday worked the kinks out enough.

lstolp [11:55 PM] 
would we go back to serial? I am just thinking that I don’t want to be harmlessly out to sea and trying make things work.. I will have not access starting sunday early early till monday late late :simple_smile:

stevefoley [11:56 PM] 
Id rather keep going to IP

lstolp [11:56 PM] 
so you think you will be able to figure this out in the next couple of days? Catie will be around for modem button pushing..

lstolp [11:58 PM]
there was not meant to be any sarcasm.. sorry if it came across that way.. :simple_smile:..

stevefoley [11:59 PM] 
Yes, Im hoping to get it hashed out tonight or tomorrow am.

----- July 30th, 2015 -----

lstolp [12:00 AM] 
ok.. great.. I will have remote access and Catie will have hands on access.. I am headed (not home, too late for that drive), but closer ..

lstolp [12:01 AM]
wow another day

stevefoley [12:01 AM] 
thanks. Again, sorry for the lag. Its throwing my whole day off, too

stevefoley [12:01 AM]
:disappointed:

lstolp [12:03 AM] 
ok.. can you send me an email on what you need me to do or next step.. thanks!

stevefoley [12:03 AM] 
will do. Hopefully, its all covered on your end now.

stevefoley [12:03 AM]
save a router and modem config?

lstolp [12:11 AM] 
saved both..

lstolp [12:11 AM]
good luck.. will check email in about an hour

lstolp [5:22 PM] 
hey steve.. how did it go?

stevefoley [5:23 PM] 
Got it narrowed down to a particular modem setting that is not behaving like every other modem I have. Im suspecting internal config or hardware problems. Im working with the vendor as I type to get through this. My backup plan will be to swap in another modem if we cant make any more headway on this box in the next hour or so.

stevefoley [5:23 PM]
Langseth needs to be online tonight, so Im under the gun now :simple_smile:

lstolp [5:34 PM] 
You can do it..

stevefoley [5:34 PM] 
Thanks for the encouragement :simple_smile:

stevefoley [8:45 PM] 
think I figured it all out.

lstolp [10:31 PM] 
ok.. what do I need to do?

stevefoley [10:31 PM] 
Ive got packets flowing from my router to 128.128.252.202, but not seeing a BGP advertisement from the ship router

lstolp [10:50 PM] 
I get: *Jul 30 22:43:46.293: %BGP_SESSION-5-ADJCHANGE: neighbor 192.168.96.129 IPv4 Unicast topology base removed from session  Peer closed the session

stevefoley [10:51 PM] 
From the ship, I take it?

stevefoley [10:51 PM]
Lemme see if I just got an update

lstolp [10:51 PM] 
yes on the ship router

stevefoley [10:52 PM] 
What address do you have on the ship router?

stevefoley [10:53 PM]
128.128.252.201?

lstolp [10:53 PM] 
yes.. I will double check..

lstolp [10:53 PM]
BGP neighbor is 192.168.96.129,  remote AS 64521, internal link
Description: ucsd-sdsc-roadnet-2611
 BGP version 4, remote router ID 0.0.0.0
 BGP state = Idle
 Configured hold time is 20, keepalive interval is 8 seconds
 Minimum holdtime from neighbor is 0 seconds
 Neighbor sessions:
   0 active, is multisession capable
 Default minimum time between advertisement runs is 0 seconds

For address family: IPv4 Unicast
 BGP table version 11, neighbor version 1/11
 Output queue size : 0
 Index 0
 NEXT_HOP is always this router
 Outgoing update network filter list is 28
 Default weight 30000
                                Sent       Rcvd
 Prefix activity:               ----       ----
   Prefixes Current:               0          0
   Prefixes Total:                 0          0
   Implicit Withdraw:              0          0
   Explicit Withdraw:              0          0
   Used as bestpath:             n/a          0
   Used as multipath:            n/a          0

                                  Outbound    Inbound
 Local Policy Denied Prefixes:    --------    -------
   Total:                                0          0
 Number of NLRIs in the update sent: max 0, min 0

 Address tracking is enabled, the RIB does have a route to 192.168.96.129
 Connections established 0; dropped 0
 Last reset never
 Transport(tcp) path-mtu-discovery is enabled
 Graceful-Restart is disabled
 No active TCP connection

stevefoley [10:55 PM] 
What is in your filter list?

stevefoley [10:55 PM]
Im expecting ip access-list standard atlantis-subnets
permit 128.128.252.0 0.0.0.15

lstolp [10:56 PM] 
logging facility local2
logging 128.128.252.2
access-list 1 permit 128.128.252.1
access-list 1 permit 128.128.252.2
access-list 28 permit 128.128.252.0 0.0.0.15
access-list 128 remark normal WHOI access
access-list 128 permit ip any 128.128.252.200 0.0.0.3
access-list 128 permit ip any 128.128.252.0 0.0.0.15
access-list 128 permit ip any 192.168.252.200 0.0.0.3
access-list 128 remark Ensure MTU negotiation works with ICMP
access-list 128 permit icmp any 128.128.252.200 0.0.0.3
access-list 128 permit icmp any 128.128.252.0 0.0.0.15
access-list 128 permit icmp any 192.168.252.200 0.0.0.3
access-list 128 remark Ensure FBB can talk GRE to our HSN-over-FBB tunnel destination IP
access-list 128 permit gre any host 137.110.255.83
!

lstolp [10:56 PM]
Are you thinking the shore router?

stevefoley [10:57 PM] 
your router should be kicking out a BGP to my shore router

stevefoley [10:57 PM]
Its active, not not completing

lstolp [10:59 PM] 
access-list 128 permit ip any 192.168.252.200 0.0.0.3

lstolp [10:59 PM]
I probably need a access-list 128 permit ip any 192.168.96.0 0.0.0.127?

stevefoley [11:00 PM] 
what does acl 128 protect?

stevefoley [11:03 PM]
You just need to be able to get a packet from your router out to 192.168.96.129. dump packets to 128.128.252.202 and you should be good. the routes are already established to get back to it.

lstolp [11:03 PM] 
it protects the tunnel and serial port

stevefoley [11:03 PM] 
Serial doesnt exist anymore.

lstolp [11:04 PM] 
i know, but we put the serial config into the ethernet config

stevefoley [11:05 PM] 
Then adjust the ACL if you need to. I think you just need a route to take traffic to 192.168.96.129 out to 128.128.252.202

stevefoley [11:05 PM]
(route and ACL changes if you need to).

lstolp [11:20 PM] 
it took the ACL off the interface, but we have lost network a couple of times.. we are in the middle of a thunderstorm.. is the langseth working?

stevefoley [11:21 PM] 
mostly.

stevefoley [11:21 PM]
just hashing out the last little route issue with the langseth.

stevefoley [11:21 PM]
its a race between you and them :simple_smile:

lstolp [11:22 PM] 
actually I am going wait till the storm is over.. tomorrow.. it that is ok..

stevefoley [11:22 PM] 
tomorrow is good. I should be at my desk the bulk of the day.

lstolp [11:23 PM] 
ok.. great.. you think it is something I have to make work, correct?

lstolp [11:23 PM]
sorry.. route, acl on the ship’s router

stevefoley [11:23 PM] 
probably. There is a path from 128.128.252.201 out to 192.168.96.129.

stevefoley [11:24 PM]
There might be a route reflection needed somewhere in there, but the mechanics are working today unlike yesterday

lstolp [11:24 PM] 
ok.. thanks.. will do.. luck to the langseth, may they win the race :simple_smile:

stevefoley [11:24 PM] 
Ive got the route-map to pop stuff into the WHOI tunnel

----- July 31st, 2015 -----

lstolp [5:17 PM] 
back at the computer..

stevefoley [5:18 PM] 
looking at your config now, looking at mine. Looks like we need to get that BGP thing happening, and that might just get the rest going.

lstolp [5:20 PM] 
sounds good, what would you like me to do?

stevefoley [5:20 PM] 
standby for a moment while I confirm my router is happy to accept your BGP requests

lstolp [5:20 PM] 
k

stevefoley [5:22 PM] 
I dont think you need to have the 192.168.96.129 in your ACL 28

stevefoley [5:22 PM]
my router is only looking for 128.128.252.1/28

lstolp [5:24 PM] 
That interface it not up right now.. shouldn’t we be able to have the bgp route w/ out that interface being up

stevefoley [5:24 PM] 
what interface isnt up?

stevefoley [5:24 PM]
Fast 0/2/0 should be up

lstolp [5:26 PM] 
Fast 0/2/0 is up and this is 128.128.252.201

lstolp [5:27 PM]
gigabit0/0 is down and this is 128.128.252.1 and goes to the ship DMZ

stevefoley [5:28 PM] 
I think we want Fast0/2/0 up so we can see the modem, and Gi0/0 so we can put packets on/off the DMZ, right?

stevefoley [5:31 PM]
So 192.168.96.129 (shore router) and your 128.128.252.201 router address can talk. that should be enough of a pathway to push DMZ information via BGP to shore.

lstolp [5:32 PM] 
I think we do want Fast0/2/0 up,  but the ship routes out  Gi0/0 and it is physically connected to another  router so that the ship has  internet. I thought I would be able to have the bgp route working w/ out the ship  passing traffic.

stevefoley [5:33 PM] 
yes, that should be possible. we should be able to swap BGP traffic

stevefoley [5:33 PM]
I think I see the problem here

lstolp [5:33 PM] 
when I show BGP neighbors.. I show No active TCP connections

stevefoley [5:34 PM] 
standby

stevefoley [5:35 PM]
much better

lstolp [5:36 PM] 
much better.. my router is saying that is should be routing out.. :simple_smile:

stevefoley [5:37 PM] 
almost much better. still something funny here maybe

lstolp [5:39 PM] 
I just tried the traceroute to 8.8.8.8 and I don’t get passed 128.128.252.205.. does it come across w/ a different ip number?

stevefoley [5:39 PM] 
looks like the bgp connection is working, just not seeing the routes. maybe being filtered

lstolp [5:40 PM] 
think we are ready to try the ship? I can track someone down to change the cables.

stevefoley [5:40 PM] 
do you have an up interface with 128.128.252.0 ? If not, your router wont advertise that it is connected

stevefoley [5:41 PM]
I think we can try the ship unless you want to test with another up interface that you can put 128.128.252.0 on for a test

lstolp [5:41 PM] 
no just the 201

lstolp [5:42 PM]
I go make some calls.. be back.. fingers crossed :simple_smile:

stevefoley [5:43 PM] 
ok. If it works, it means we had it all setup on Wednesday except for my one bonehead config line here

lstolp [6:11 PM] 
if have the ship on .. if I try and traceroute from 128.128.252.2 which is directly connected to 128.128.252.1, I am not getting anywhere.. permission issue?

stevefoley [6:12 PM] 
can 128.12.252.1 get out to the internet?

stevefoley [6:12 PM]
is WHOI squashing traceroutes?

stevefoley [6:12 PM]
btw, I see the route from your router

lstolp [6:13 PM] 
I was tracerouting to 8.8.8.8 and before I could get to 205 at least.. let me check .1

stevefoley [6:13 PM] 
128.128.0.0/16 is variably subnetted, 3 subnets, 2 masks
C       128.128.252.204/30 is directly connected, Tunnel82
B       128.128.252.200/30 [200/0] via 192.168.96.193, 20:32:31
B       128.128.252.0/28 [200/0] via 128.128.252.201, 00:11:54

stevefoley [6:15 PM]
I think I just need to put a static route in the ship modem to get 128.128.252.1 back to 128.128.252.201 when packets come that way.

lstolp [6:15 PM] 
can you get to the ship modem now?

stevefoley [6:15 PM] 
yep. standby

stevefoley [6:18 PM]
does that make things better?

stevefoley [6:19 PM]
sure looks like packets are headed back from the internet to 128.128.252.2

stevefoley [6:19 PM]
Can you confirm that its good?

stevefoley [6:20 PM]
if so,Ill want to reset the modem and confirm that is still the case after a reboot.

lstolp [6:21 PM] 
beautiful :simple_smile:.. I can ping from the ship to shore..

stevefoley [6:22 PM] 
Can I reboot the modem now (dropping the link for a minute) to verify that the static route comes back up with the reboot?

stevefoley [6:22 PM]
I already saved the router config

stevefoley [6:22 PM]
er modem config

lstolp [6:22 PM] 
yeah.. have at it..

stevefoley [6:22 PM] 
standby

stevefoley [6:26 PM]
hmmm…didnt see it come back up with the route.

stevefoley [6:27 PM]
Ill add it back in by hand for now, and maybe we can verify the FBB failover works while I see what I can do to get that route to load.

stevefoley [6:28 PM]
should be working now, ready for a FBB failover test on your end

lstolp [6:28 PM] 
ok.. looks to working.. I will take down HSN.. one second

lstolp [6:30 PM]
it looks to be going out FBB failover.. pings are nice and slow :simple_smile:

stevefoley [6:30 PM] 
lemme confirm on my router

stevefoley [6:30 PM]
standby

lstolp [6:30 PM] 
64 bytes from 8.8.8.8: icmp_seq=492 ttl=45 time=904 ms
64 bytes from 8.8.8.8: icmp_seq=493 ttl=45 time=906 ms
64 bytes from 8.8.8.8: icmp_seq=494 ttl=45 time=905 ms
64 bytes from 8.8.8.8: icmp_seq=495 ttl=45 time=901 ms
64 bytes from 8.8.8.8: icmp_seq=496 ttl=45 time=901 ms
64 bytes from 8.8.8.8: icmp_seq=497 ttl=45 time=901 ms
64 bytes from 8.8.8.8: icmp_seq=498 ttl=45 time=901 ms
64 bytes from 8.8.8.8: icmp_seq=521 ttl=40 time=1947 ms
64 bytes from 8.8.8.8: icmp_seq=522 ttl=40 time=1907 ms
64 bytes from 8.8.8.8: icmp_seq=523 ttl=40 time=1466 ms
64 bytes from 8.8.8.8: icmp_seq=524 ttl=40 time=862 ms
64 bytes from 8.8.8.8: icmp_seq=525 ttl=40 time=1703 ms
64 bytes from 8.8.8.8: icmp_seq=526 ttl=40 time=1737 ms
64 bytes from 8.8.8.8: icmp_seq=527 ttl=40 time=1754 ms
64 bytes from 8.8.8.8: icmp_seq=528 ttl=40 time=1172 ms

lstolp [6:31 PM]
you can see where it went over

lstolp [6:32 PM]
nope.. it failed over the last resort FBB, not the HSN-over-FBB route.. I will shutdown that interface so it is not so confusing

stevefoley [6:32 PM] 
ok.

stevefoley [6:32 PM]
I was going to say that it didnt look to be flowing through me at all

lstolp [6:34 PM] 
Ok the backup backup is down.. when I first brought HSN down, I got this error message:
Jul 31 18:29:34.718: %COMMON_FIB-6-FIB_RECURSION:  has too many (8) levels of recursion during process

stevefoley [6:35 PM] 
not sure what that is about

stevefoley [6:35 PM]
dont see any routes updating here...

lstolp [6:36 PM] 
i don’t see anything either.. I have not gateway

lstolp [6:38 PM]
The interface is up, but the tunnel protocol is down

lstolp [6:38 PM]
at-hiseasnet#int
Interface                  IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0         128.128.252.1   YES NVRAM  up                    up      
GigabitEthernet0/1         128.128.200.147 YES NVRAM  down                  down    
GigabitEthernet0/2         216.86.248.179  YES DHCP   up                    up      
FastEthernet0/0/0          192.168.100.5   YES NVRAM  administratively down down    
FastEthernet0/1/0          199.92.161.185  YES NVRAM  up                    up      
FastEthernet0/2/0          128.128.252.201 YES manual administratively down down    
Serial0/3/0                unassigned      YES manual administratively down down    
Serial0/3/1                unassigned      YES manual administratively down down    
NVI0                       unassigned      YES unset  administratively down down    
Tunnel10                   192.168.252.201 YES NVRAM  up                    down

lstolp [6:39 PM]
where is the other end of the tunnel?

stevefoley [6:41 PM] 
here on my router

stevefoley [6:44 PM]
sorry…had a phone call.

stevefoley [6:45 PM]
I dont see any packets flowing through the tunnel.

stevefoley [6:45 PM]
FBB tunnel that is.

stevefoley [6:45 PM]
I see a few, but they could be keep alives

stevefoley [6:45 PM]
what does your route table look like?

lstolp [6:46 PM] 
what should I try.. I seems like it does not see the other side of the tunnel, does it need a route to go through the modem?

stevefoley [6:46 PM] 
and what interfaces did you take down?

lstolp [6:47 PM] 
I took down the HSN and the second FBB.. the HSN-over-FBB should be GigabitEthernet0/2

stevefoley [6:47 PM] 
the deal is that if the BGP to my router dies, your router should try to BGP  the 128.128.252.0 route through the FBB tunnel.

stevefoley [6:48 PM]
Im not seeing BGP from your 192.168.252.201 address.

stevefoley [6:48 PM]
so your Gi0/2 is up?

lstolp [6:49 PM] 
yes.. it says it is.. it was working last cruise

stevefoley [6:49 PM] 
and your tun10 is up?

lstolp [6:49 PM] 
my tunnel is up, but the protocol shows down, like it does not see the other side..

stevefoley [6:50 PM] 
sounds like the FBB link is down then?

stevefoley [6:50 PM]
can you ping the world through fbb on Gi0/2?

stevefoley [6:52 PM]
can you send me a copy of your route table?

lstolp [6:53 PM] 
at-hiseasnet#rn
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
      D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
      N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
      E1 - OSPF external type 1, E2 - OSPF external type 2
      i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
      ia - IS-IS inter area, * - candidate default, U - per-user static route
      o - ODR, P - periodic downloaded static route, + - replicated route

Gateway of last resort is not set

     128.128.0.0/16 is variably subnetted, 2 subnets, 2 masks
C        128.128.252.0/28 is directly connected, GigabitEthernet0/0
L        128.128.252.1/32 is directly connected, GigabitEthernet0/0
     137.110.0.0/32 is subnetted, 1 subnets
S        137.110.255.83 [1/0] via 216.86.248.178, GigabitEthernet0/2
     199.92.161.0/24 is variably subnetted, 2 subnets, 2 masks
C        199.92.161.0/24 is directly connected, FastEthernet0/1/0
L        199.92.161.185/32 is directly connected, FastEthernet0/1/0
     216.86.248.0/24 is variably subnetted, 2 subnets, 2 masks
C        216.86.248.0/24 is directly connected, GigabitEthernet0/2
L        216.86.248.179/32 is directly connected, GigabitEthernet0/2
at-hiseasnet#

stevefoley [6:53 PM] 
in your current configuration (FBB up, HSN down), can you ping 137.110.255.83?

stevefoley [6:54 PM]
or can you ping 216.86.248.178?

lstolp [6:55 PM] 
I cannot ping 216.86.248.178, maybe the fbb is down and not working

stevefoley [6:55 PM] 
yep, sure seems like the FBB isnt linked up.

stevefoley [6:56 PM]
216.86.248.178 is the first stop on the other side of a happy FBB link.

lstolp [6:57 PM] 
I will have Robbie repower the BDU, sometimes that helps

stevefoley [7:02 PM] 
ok

stevefoley [7:02 PM]
‘bout time Robbie does some work :wink:

lstolp [7:02 PM] 
Robbie repowered the unit, the interfaced went down and came back up, but the tunnel remains down

stevefoley [7:03 PM] 
is the FBB actually attached to Gi0/2? online?

lstolp [7:03 PM] 
yes

stevefoley [7:03 PM] 
At this point, it should be pretty simple to ping one hop from router to an FBB static address.

stevefoley [7:03 PM]
that doesnt involve any fancy logic or HSN setup.

lstolp [7:06 PM] 
I cannot get there.. we had to put the FBB into a one to one w/ the cisco router only.. testing the other ports on the FBB will not really tell us anything… maybe we should just go w/ what we have for now and next time the ship is at WHOI I can make sure that port is working.. are you sure we should not be changing some of the logic in the cisco router for the FBB-over-HSN to work through the modem?

stevefoley [7:09 PM] 
The HSN-over-FBB logic basically says that if the HSN route dies and cant be restarted, make a link to the earth station through the FBB tunnel instead of over the HSN sat link. When things come through the tunnel, both shore and ship router agree to route traffic around through FBB. We actually didnt change any of that logic. We just messed with the stuff on the HSN routing side.

stevefoley [7:09 PM]
Im pretty sure the failover would work if FBB were online

stevefoley [7:10 PM]
should we call it good there?

stevefoley [7:11 PM]
Ive got a query into our modem vendor to address the modems-static-route-does-not-load-on-modem-reboot issue Im seeing. As long as HSN is online, I should be able to address that issue from here. Worst case is a firmware upgrade may be required.

stevefoley [7:11 PM]
Let me know who I might call on for that if needed. If not, things are working.

lstolp [7:11 PM] 
We did add a static route:ip route 192.168.96.129 255.255.255.255 128.128.252.202

lstolp [7:12 PM]
should we add the same for 192.168.252.202?

stevefoley [7:12 PM] 
we may not need it. standby while I check

stevefoley [7:14 PM]
shouldnt need it. Once you go to FBB, your link to .129 will die (fine), and your BGP traffic will go through your 192.168.252.200/30 tunnel network.

stevefoley [7:14 PM]
shouldnt be a need to talk to .129 when you are on FBB.

lstolp [7:16 PM] 
ok.. makes sense.. guess we are good till we know more about the FBB. Catie will be on board till Monday and I think Dave Simms shows up on Monday.. sssg@atlantis.whoi.edu/sssg@whoi.edu should get someone :simple_smile:

stevefoley [7:17 PM] 
awesome. Sorry it took so long to get hashed out. Looks like your stuff was pretty solid, just a few bonehead mistakes on my end this go around :simple_smile:

stevefoley [7:17 PM]
Ill declare victory with a potential to follow up with the modem route issue
